软件工程学院　　数据库设计报告\
Strove AI 写作助手　　V1.0 | 2025-12-29



<a name="_toc94685087"></a>**数据库设计报告**

**【Strove AI 写作助手】**





<table><tr><th rowspan="7"><p>文件状态：</p><p>[√] 草稿</p><p>[  ] 正式发布</p><p>[  ] 正在修改</p></th><th valign="top">文件标识：</th><th valign="top">QST-SSM-STROVE-DOC-DB</th></tr>
<tr><td valign="top">当前版本：</td><td valign="top">1.0</td></tr>
<tr><td valign="top">作    者：</td><td valign="top">Erokin Team</td></tr>
<tr><td valign="top">完成日期：</td><td valign="top">2025-12-29</td></tr>
<tr><td valign="top">批 准 人：</td><td valign="top"></td></tr>
<tr><td valign="top">批准日期：</td><td valign="top"></td></tr>
<tr><td valign="top">签    字：</td><td valign="top"></td></tr>
</table>
【软件工程学院】




**变更历史**

|**序号**|**版本**|**变更日期**|**变更内容**|**变更者**|
| :-: | :-: | :-: | :-: | :-: |
|1|1.0|2025-12-29|初始版本创建|Erokin Team|
|2|||||
|3|||||
|4|||||
|5|||||




## 目 录<a name="_toc298400441"></a>

[**0. 文档介绍**](#_toc299638930)

[0.1 文档目的](#_toc299638931)

[0.2 文档范围](#_toc299638932)

[0.3 读者对象](#_toc299638933)

[0.4 参考文献](#_toc299638934)

[0.5 术语与缩写解释](#_toc299638935)

[**1. 数据库环境说明**](#_toc299638936)

[**2. 数据库的命名规则**](#_toc299638937)

[**3. 逻辑设计**](#_toc299638938)

[**4. 物理设计**](#_toc299638939)

[4.0 表汇总](#_toc299638940)

[4.1 用户表 (users)](#_toc299638941)

[4.2 对话记录表 (conversations)](#_toc299638942)

[4.3 文档表 (documents)](#_toc299638943)

[4.4 提示词模板表 (prompt_templates)](#_toc299638944)

[**5. 安全性设计**](#_toc299638945)

[5.1 防止用户直接操作数据库的方法](#_toc299638946)

[5.2 用户帐号密码的加密方法](#_toc299638947)

[5.3 角色与权限](#_toc299638948)

[**6. 优化**](#_toc299638949)

[**7. 数据库管理与维护说明**](#_toc299638950)




# <a name="_toc299638930"></a>**0. 文档介绍**

## <a name="_toc299638931"></a>0.1 文档目的

本文档旨在详细描述 Strove AI 写作助手系统的数据库设计方案，包括数据库环境、命名规则、逻辑结构、物理结构、安全性设计及优化策略。本文档为开发人员提供数据库实施的技术依据，为测试人员提供数据验证标准，为维护人员提供数据库管理参考。

## <a name="_toc299638932"></a>0.2 文档范围

本文档涵盖 Strove AI 写作助手系统数据库的完整设计，包括：
- 数据库环境配置说明
- 数据库命名规范
- 实体关系模型（E-R图）
- 数据表物理结构设计
- 索引与约束设计
- 安全性与权限控制
- 性能优化策略
- 数据库维护方案

## <a name="_toc299638933"></a>0.3 读者对象

本文档的主要读者包括：
- 数据库管理员（DBA）
- 后端开发工程师
- 系统测试工程师
- 项目经理
- 系统运维人员

## <a name="_toc299638934"></a>0.4 参考文献

[SRS] Erokin Team，《Strove AI 写作助手软件需求规格说明书》，软件工程学院，2025-12-25

[API-DOC] Erokin Team，《Strove AI 写作助手后端接口文档》，软件工程学院，2025-12-25

[README] Erokin Team，《Strove AI 写作助手项目说明》，软件工程学院，2025-12-29

## <a name="_toc299638935"></a>0.5 术语与缩写解释

|**缩写、术语**|**解 释**|
| :-: | :-: |
|SSM|Spring + Spring MVC + MyBatis 框架组合|
|JPA|Java Persistence API，Java 持久化 API|
|BCrypt|一种密码哈希加密算法|
|JWT|JSON Web Token，用于身份验证的令牌|
|AI|Artificial Intelligence，人工智能|
|E-R图|Entity-Relationship Diagram，实体关系图|
|CRUD|Create, Read, Update, Delete 数据库基本操作|




# <a name="_toc299638936"></a>**1. 数据库环境说明**

（1）**数据库系统**：MySQL 8.0

（2）**开发工具**：
- 数据库设计工具：MySQL Workbench
- 后端框架：Spring Boot 3.5.7 + Spring Data JPA
- 开发环境：IntelliJ IDEA 2024

（3）**详细配置**：

|**配置项**|**配置值**|
| :-: | :-: |
|数据库名称|strove_db|
|字符集|utf8mb4|
|排序规则|utf8mb4_unicode_ci|
|存储引擎|InnoDB|
|默认端口|3306|
|时区设置|Asia/Shanghai|
|最大连接数|200|
|事务隔离级别|READ_COMMITTED|




# <a name="_toc299638937"></a>**2. 数据库的命名规则**

本数据库遵循以下命名规范：

（1）**数据库命名**：使用小写字母加下划线，格式为 `项目名_db`，如 `strove_db`

（2）**表命名**：
- 使用小写字母和下划线分隔
- 使用复数形式表示表名，如 `users`、`documents`
- 表名应具有业务含义，避免使用缩写

（3）**字段命名**：
- 使用小写字母和下划线分隔
- 主键统一命名为 `id`
- 外键命名格式为 `关联表名_id`，如 `user_id`
- 时间字段统一使用 `created_at`、`updated_at`
- 布尔类型字段使用 `is_` 前缀，如 `is_active`

（4）**索引命名**：
- 普通索引：`idx_字段名`，如 `idx_email`
- 唯一索引：`uk_字段名`，如 `uk_username`
- 外键约束：`fk_表名_关联表名`，如 `fk_conversation_user`

（5）**视图命名**：使用 `v_` 或业务名称加 `_stats` 后缀，如 `user_stats`




# <a name="_toc299638938"></a>**3. 逻辑设计**

## 3.1 系统实体关系图（E-R图）

本系统包含 4 个核心实体：用户（User）、对话记录（Conversation）、文档（Document）、提示词模板（PromptTemplate）。

**实体及属性：**

1. **用户（User）**
   - 主键：用户ID
   - 属性：用户名、邮箱、密码、创建时间、更新时间

2. **对话记录（Conversation）**
   - 主键：对话记录ID
   - 属性：用户ID、文档ID、用户消息、AI响应、创建时间
   - 外键：用户ID

3. **文档（Document）**
   - 主键：文档ID
   - 属性：用户ID、标题、内容、字数统计、创建时间、更新时间
   - 外键：用户ID

4. **提示词模板（PromptTemplate）**
   - 主键：模板ID
   - 属性：名称、分类、模板内容、描述、使用次数、是否启用、创建时间、更新时间

## 3.2 实体间关系

（1）**用户 与 对话记录**：一对多关系（1:N）
- 一个用户可以拥有多条对话记录
- 一条对话记录只属于一个用户

（2）**用户 与 文档**：一对多关系（1:N）
- 一个用户可以创建多个文档
- 一个文档只属于一个用户

（3）**对话记录 与 文档**：多对一关系（N:1，可选）
- 一条对话记录可以关联一个文档（可为空）
- 一个文档可以关联多条对话记录

（4）**提示词模板**：独立实体，无外键关联




# <a name="_toc299638939"></a>**4. 物理设计**

## <a name="_toc299638940"></a>4.0 表汇总

|**表名**|**中文名称**|**功能说明**|
| :-: | :-: | :-: |
|users|用户表|存储用户基本信息及登录凭证|
|conversations|对话记录表|存储用户与AI的对话历史|
|documents|文档表|存储用户创建的Markdown文档|
|prompt_templates|提示词模板表|存储系统内置的写作提示词模板|
|user_stats|用户统计视图|统计用户的对话和文档数量|

## <a name="_toc299638941"></a>4.1 用户表 (users)

|**#**|**字段**|**名称**|**数据类型**|**主键**|**非空**|**默认值**|**备注说明**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|1|id|用户ID|BIGINT|√|√||自增主键|
|2|username|用户名|VARCHAR(50)||√||唯一，用于登录|
|3|email|邮箱|VARCHAR(100)||√||唯一，用于登录|
|4|password|密码|VARCHAR(255)||√||BCrypt加密存储|
|5|created_at|创建时间|TIMESTAMP||√|CURRENT_TIMESTAMP||
|6|updated_at|更新时间|TIMESTAMP||√|CURRENT_TIMESTAMP|自动更新|

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `uk_username` (`username`)
- UNIQUE INDEX `uk_email` (`email`)
- INDEX `idx_email` (`email`)
- INDEX `idx_username` (`username`)

**补充说明：**
- 密码字段使用 BCrypt 算法加密，密文长度为 60 字符
- username 和 email 均可用于登录
- 时间字段使用 TIMESTAMP 类型，支持自动更新

## <a name="_toc299638942"></a>4.2 对话记录表 (conversations)

|**#**|**字段**|**名称**|**数据类型**|**主键**|**非空**|**默认值**|**备注说明**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|1|id|对话记录ID|BIGINT|√|√||自增主键|
|2|user_id|用户ID|BIGINT||√||外键关联users表|
|3|document_id|关联文档ID|BIGINT||||可选，关联documents表|
|4|message|用户消息|TEXT||√||用户输入的内容|
|5|response|AI响应|TEXT||||AI返回的内容|
|6|created_at|创建时间|TIMESTAMP||√|CURRENT_TIMESTAMP||

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_user_id` (`user_id`)
- INDEX `idx_created_at` (`created_at`)

**外键约束：**
- CONSTRAINT `fk_conversation_user` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**补充说明：**
- 删除用户时，级联删除该用户的所有对话记录
- document_id 为可选字段，用于关联特定文档的对话
- 按创建时间倒序查询，优化历史记录检索

## <a name="_toc299638943"></a>4.3 文档表 (documents)

|**#**|**字段**|**名称**|**数据类型**|**主键**|**非空**|**默认值**|**备注说明**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|1|id|文档ID|BIGINT|√|√||自增主键|
|2|user_id|用户ID|BIGINT||√||外键关联users表|
|3|title|文档标题|VARCHAR(200)||√|'未命名文档'||
|4|content|Markdown内容|LONGTEXT||||支持大文本存储|
|5|word_count|字数统计|INT|||0|自动计算|
|6|created_at|创建时间|TIMESTAMP||√|CURRENT_TIMESTAMP||
|7|updated_at|更新时间|TIMESTAMP||√|CURRENT_TIMESTAMP|自动更新|

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_user_id` (`user_id`)
- INDEX `idx_updated_at` (`updated_at`)

**外键约束：**
- CONSTRAINT `fk_document_user` FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE

**补充说明：**
- 删除用户时，级联删除该用户的所有文档
- content 字段使用 LONGTEXT 类型，最大支持 4GB 文本
- word_count 由应用层计算并更新

## <a name="_toc299638944"></a>4.4 提示词模板表 (prompt_templates)

|**#**|**字段**|**名称**|**数据类型**|**主键**|**非空**|**默认值**|**备注说明**|
| :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
|1|id|模板ID|BIGINT|√|√||自增主键|
|2|name|模板名称|VARCHAR(100)||√||如"工作总结"|
|3|category|分类|VARCHAR(50)||√||工作/学习/生活/通用|
|4|template_content|模板内容|TEXT||√||带占位符的模板文本|
|5|description|模板描述|VARCHAR(255)||||使用场景说明|
|6|usage_count|使用次数|INT|||0|统计模板使用频率|
|7|is_active|是否启用|BOOLEAN|||TRUE|控制模板可见性|
|8|created_at|创建时间|TIMESTAMP||√|CURRENT_TIMESTAMP||
|9|updated_at|更新时间|TIMESTAMP||√|CURRENT_TIMESTAMP|自动更新|

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_category` (`category`)
- INDEX `idx_is_active` (`is_active`)

**补充说明：**
- 系统内置 5 个常用模板：工作总结、学生短文、职场邮件、读后感、润色文案
- template_content 中使用 `[占位符]` 标记可替换内容
- is_active 字段用于软删除，不物理删除模板

## 4.5 用户统计视图 (user_stats)

```sql
CREATE VIEW user_stats AS
SELECT 
    u.id AS user_id,
    u.username,
    u.email,
    COUNT(DISTINCT c.id) AS conversation_count,
    COUNT(DISTINCT d.id) AS document_count,
    u.created_at AS register_date
FROM users u
LEFT JOIN conversations c ON u.id = c.user_id
LEFT JOIN documents d ON u.id = d.user_id
GROUP BY u.id, u.username, u.email, u.created_at;
```

**补充说明：**
- 视图用于快速查询用户的统计信息
- 包含对话数量和文档数量的汇总




# <a name="_toc299638945"></a>**5. 安全性设计**

## <a name="_toc299638946"></a>5.1 防止用户直接操作数据库的方法

（1）**应用层隔离**：
- 用户只能通过 Web 应用程序访问数据，无法直接连接数据库
- 后端使用 Spring Security + JWT 进行身份验证和授权
- 所有数据库操作通过 JPA Repository 层封装

（2）**网络隔离**：
- 数据库服务器仅允许应用服务器 IP 访问
- 生产环境禁用 root 远程登录
- 使用专用数据库用户 `strove_app`，仅授予必要权限

（3）**SQL 注入防护**：
- 使用 JPA 参数化查询，避免拼接 SQL
- 对用户输入进行严格校验和转义
- 启用 MySQL 的 `sql_mode` 严格模式

## <a name="_toc299638947"></a>5.2 用户帐号密码的加密方法

（1）**密码加密算法**：BCrypt
- 使用 Spring Security 提供的 BCryptPasswordEncoder
- 自动生成随机盐值（salt）
- 加密强度：10 轮哈希运算

（2）**加密流程**：
```
用户注册 → 明文密码 → BCrypt.hash(password, salt) → 密文存储
用户登录 → 明文密码 → BCrypt.verify(password, hash) → 验证成功/失败
```

（3）**密钥管理**：
- JWT 密钥存储在环境变量 `JWT_SECRET` 中
- 生产环境使用至少 32 字符的随机密钥
- 定期轮换 JWT 密钥（建议每 90 天）

## <a name="_toc299638948"></a>5.3 角色与权限

本系统采用基于 JWT 的无状态认证，暂未实现复杂的角色权限系统。当前权限设计如下：

<table><tr><th valign="top">角色</th><th valign="top">可以访问的表与列</th><th valign="top">操作权限</th></tr>
<tr><td rowspan="4" valign="top"><p></p><p>普通用户</p></td><td valign="top">users（仅自己的记录）</td><td valign="top">SELECT, UPDATE（密码、用户名）</td></tr>
<tr><td valign="top">conversations（仅自己的记录）</td><td valign="top">SELECT, INSERT, DELETE</td></tr>
<tr><td valign="top">documents（仅自己的记录）</td><td valign="top">SELECT, INSERT, UPDATE, DELETE</td></tr>
<tr><td valign="top">prompt_templates（所有记录）</td><td valign="top">SELECT（仅 is_active=TRUE）</td></tr>
<tr><td rowspan="4" valign="top"><p></p><p>管理员</p></td><td valign="top">users（所有记录）</td><td valign="top">SELECT, INSERT, UPDATE, DELETE</td></tr>
<tr><td valign="top">conversations（所有记录）</td><td valign="top">SELECT, DELETE</td></tr>
<tr><td valign="top">documents（所有记录）</td><td valign="top">SELECT, DELETE</td></tr>
<tr><td valign="top">prompt_templates（所有记录）</td><td valign="top">SELECT, INSERT, UPDATE, DELETE</td></tr>
</table>

**补充说明：**
- 当前版本通过 JWT 中的 `userId` 实现数据隔离
- 后续版本可扩展为基于角色的访问控制（RBAC）




# <a name="_toc299638949"></a>**6. 优化**

## 6.1 索引优化

|**优先级**|**优化对象（目标）**|**措施**|
| :-: | :-: | :-: |
|高|用户登录查询性能|在 users 表的 email 和 username 字段创建唯一索引|
|高|对话历史查询性能|在 conversations 表的 user_id 和 created_at 创建复合索引|
|中|文档列表查询性能|在 documents 表的 user_id 和 updated_at 创建复合索引|
|中|模板分类查询性能|在 prompt_templates 表的 category 和 is_active 创建复合索引|

## 6.2 存储优化

|**优先级**|**优化对象（目标）**|**措施**|
| :-: | :-: | :-: |
|中|大文本存储效率|documents.content 使用 LONGTEXT，启用 InnoDB 行压缩|
|低|历史数据归档|定期归档 90 天前的 conversations 数据到历史表|
|低|数据库空间占用|定期清理软删除的 prompt_templates 记录|

## 6.3 查询优化

|**优先级**|**优化对象（目标）**|**措施**|
| :-: | :-: | :-: |
|高|避免全表扫描|所有查询条件字段均已创建索引|
|中|减少JOIN查询|使用 user_stats 视图预聚合统计数据|
|中|分页查询性能|使用 LIMIT + OFFSET，配合 updated_at 索引|

## 6.4 连接池优化

- 使用 HikariCP 连接池（Spring Boot 默认）
- 最小连接数：10
- 最大连接数：50
- 连接超时：30 秒
- 空闲超时：600 秒




# <a name="_toc299638950"></a>**7. 数据库管理与维护说明**

## 7.1 数据备份策略

（1）**全量备份**：
- 频率：每天凌晨 2:00 执行
- 保留周期：最近 7 天
- 备份命令：
```bash
mysqldump -u root -p --databases strove_db --single-transaction > backup_$(date +%Y%m%d).sql
```

（2）**增量备份**：
- 启用 MySQL binlog
- 保留周期：最近 7 天
- 配置：`log_bin = /var/log/mysql/mysql-bin.log`

## 7.2 数据恢复方案

（1）**全量恢复**：
```bash
mysql -u root -p strove_db < backup_20251229.sql
```

（2）**增量恢复**：
```bash
mysqlbinlog mysql-bin.000001 | mysql -u root -p strove_db
```

## 7.3 日常维护任务

|**任务**|**频率**|**说明**|
| :-: | :-: | :-: |
|检查慢查询日志|每周|分析并优化执行时间超过 2 秒的查询|
|优化表碎片|每月|执行 `OPTIMIZE TABLE` 整理表空间|
|检查索引使用情况|每月|使用 `EXPLAIN` 分析查询计划|
|更新表统计信息|每周|执行 `ANALYZE TABLE` 更新索引统计|
|监控磁盘空间|每天|确保数据库磁盘使用率低于 80%|

## 7.4 数据库用户管理

（1）**创建应用专用用户**：
```sql
CREATE USER 'strove_app'@'localhost' IDENTIFIED BY 'secure_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON strove_db.* TO 'strove_app'@'localhost';
FLUSH PRIVILEGES;
```

（2）**权限最小化原则**：
- 应用用户仅授予 CRUD 权限
- 禁止授予 DROP、ALTER 等 DDL 权限
- 生产环境禁用 root 远程访问

## 7.5 监控与告警

（1）**监控指标**：
- 数据库连接数
- 慢查询数量
- 表空间使用率
- 主从复制延迟（如有）

（2）**告警阈值**：
- 连接数超过 80%：警告
- 慢查询超过 10 次/小时：警告
- 磁盘使用率超过 85%：严重告警

---

**文档结束**
