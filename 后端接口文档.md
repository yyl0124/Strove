# Strove AI 写作助手 - 后端接口文档

**版本**: v1.0.0  
**基础URL**: `http://localhost:8123/api`  
**更新时间**: 2025-12-25

---

## 目录

1. [通用说明](#1-通用说明)
2. [认证接口](#2-认证接口)
3. [AI功能接口](#3-ai功能接口)
4. [文档管理接口](#4-文档管理接口)
5. [系统工具接口](#5-系统工具接口)
6. [数据模型](#6-数据模型)
7. [错误码说明](#7-错误码说明)

---

## 1. 通用说明

### 1.1 请求格式
- 所有请求均使用 `JSON` 格式
- Content-Type: `application/json`
- 需要认证的接口需携带 JWT Token

### 1.2 响应格式
所有接口均返回统一的响应结构：

```json
{
  "success": true,
  "message": "操作成功",
  "data": {}
}
```

### 1.3 认证方式
需要认证的接口需在 HTTP Header 中添加：
```
Authorization: Bearer <JWT_TOKEN>
```

### 1.4 支持的AI服务商
- **OpenAI**: `https://api.openai.com/v1`
- **通义千问**: `https://dashscope.aliyuncs.com/compatible-mode/v1`
- **Deepseek**: `https://api.deepseek.com`
- **月之暗面Kimi**: `https://api.moonshot.cn/v1`
- **其他兼容OpenAI协议的服务**

---

## 2. 认证接口

### 2.1 用户注册

**接口**: `POST /api/auth/register`  
**描述**: 创建新用户账号  
**认证**: 不需要

#### 请求参数

```json
{
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123"
}
```

| 字段 | 类型 | 必填 | 说明 | 验证规则 |
|------|------|------|------|----------|
| username | String | 是 | 用户名 | 3-50字符 |
| email | String | 是 | 邮箱 | 有效的邮箱格式 |
| password | String | 是 | 密码 | 6-100字符 |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userId": 1,
    "username": "testuser",
    "email": "test@example.com"
  }
}
```

**失败 (200)**
```json
{
  "success": false,
  "message": "邮箱已被注册",
  "data": null
}
```

---

### 2.2 用户登录

**接口**: `POST /api/auth/login`  
**描述**: 用户登录获取JWT Token  
**认证**: 不需要

#### 请求参数

```json
{
  "loginName": "test@example.com",
  "password": "password123"
}
```

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| loginName | String | 是 | 登录名（可以是邮箱或用户名） |
| password | String | 是 | 密码 |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "userId": 1,
    "username": "testuser",
    "email": "test@example.com"
  }
}
```

**失败 (200)**
```json
{
  "success": false,
  "message": "用户名或密码错误",
  "data": null
}
```

---

## 3. AI功能接口

### 3.1 AI对话

**接口**: `POST /api/ai/chat`  
**描述**: 与AI进行对话，获取写作建议  
**认证**: 需要 (Bearer Token)

#### 请求参数

```json
{
  "message": "帮我写一篇关于春天的短文",
  "apiKey": "sk-xxxxxxxxxxxxxxxx",
  "provider": "openai",
  "model": "gpt-3.5-turbo",
  "apiUrl": "https://api.openai.com/v1"
}
```

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| message | String | 是 | 用户消息内容 |
| apiKey | String | 否 | AI服务商API密钥 |
| provider | String | 否 | 服务商标识（openai/qianwen/deepseek等） |
| model | String | 否 | 模型名称 |
| apiUrl | String | 否 | 自定义API地址 |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    "reply": "春天是一个充满生机的季节...",
    "conversationId": 123
  }
}
```

**失败 (200)**
```json
{
  "success": false,
  "message": "AI请求失败：API密钥无效",
  "data": null
}
```

---

### 3.2 测试连接

**接口**: `POST /api/ai/test-connection`  
**描述**: 测试AI服务商连接是否正常  
**认证**: 不需要

#### 请求参数

```json
{
  "apiKey": "sk-xxxxxxxxxxxxxxxx",
  "provider": "openai",
  "model": "gpt-3.5-turbo",
  "apiUrl": "https://api.openai.com/v1"
}
```

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| apiKey | String | 是 | API密钥 |
| provider | String | 是 | 服务商标识 |
| model | String | 是 | 模型名称 |
| apiUrl | String | 否 | 自定义API地址 |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    "connected": true,
    "provider": "openai",
    "model": "gpt-3.5-turbo",
    "message": "连接成功"
  }
}
```

---

### 3.3 生成灵感

**接口**: `POST /api/ai/inspiration`  
**描述**: 根据关键词生成3-5条写作灵感  
**认证**: 不需要

#### 请求参数

```json
{
  "keyword": "春日游记",
  "apiKey": "sk-xxxxxxxxxxxxxxxx",
  "provider": "openai",
  "model": "gpt-3.5-turbo",
  "apiUrl": "https://api.openai.com/v1"
}
```

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| keyword | String | 是 | 关键词 |
| apiKey | String | 否 | API密钥 |
| provider | String | 否 | 服务商标识 |
| model | String | 否 | 模型名称 |
| apiUrl | String | 否 | 自定义API地址 |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": [
    "从清晨的第一缕阳光写起，描绘春日的宁静美好",
    "以樱花盛开为线索，串联起一路的惊喜和感动",
    "讲述与朋友踏青的趣事，展现春天的活力",
    "对比城市与自然的春天，表达回归自然的渴望",
    "用细腻的笔触描写春天的色彩、声音和气味"
  ]
}
```

---

### 3.4 润色文本

**接口**: `POST /api/ai/polish`  
**描述**: 对指定文本进行AI润色  
**认证**: 需要 (Bearer Token)

#### 请求参数

```json
{
  "text": "我们公司是一家专业的软件开发企业",
  "apiKey": "sk-xxxxxxxxxxxxxxxx",
  "provider": "openai",
  "model": "gpt-3.5-turbo",
  "style": "专业",
  "apiUrl": "https://api.openai.com/v1"
}
```

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| text | String | 是 | 待润色的文本 |
| apiKey | String | 否 | API密钥 |
| provider | String | 否 | 服务商标识 |
| model | String | 否 | 模型名称 |
| style | String | 否 | 润色风格（专业/生动/简洁） |
| apiUrl | String | 否 | 自定义API地址 |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": "我们是一家致力于提供卓越软件解决方案的专业技术企业，以创新为驱动，为客户创造价值。"
}
```

---

### 3.5 获取对话历史

**接口**: `GET /api/ai/conversations?limit=20`  
**描述**: 获取当前用户的对话历史记录  
**认证**: 需要 (Bearer Token)

#### 查询参数

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| limit | Integer | 否 | 20 | 返回记录数量 |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": [
    {
      "id": 123,
      "userId": 1,
      "documentId": null,
      "message": "帮我写一篇关于春天的短文",
      "response": "春天是一个充满生机的季节...",
      "createdAt": "2025-12-25T10:30:00"
    },
    {
      "id": 122,
      "userId": 1,
      "documentId": 5,
      "message": "润色这段文字",
      "response": "已为您润色完成...",
      "createdAt": "2025-12-25T09:15:00"
    }
  ]
}
```

---

### 3.6 删除对话记录

**接口**: `DELETE /api/ai/conversations/{id}`  
**描述**: 删除指定的对话记录  
**认证**: 需要 (Bearer Token)

#### 路径参数

| 参数 | 类型 | 说明 |
|------|------|------|
| id | Long | 对话记录ID |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "删除成功",
  "data": null
}
```

**失败 (200)**
```json
{
  "success": false,
  "message": "对话记录不存在或无权限删除",
  "data": null
}
```

---

## 4. 文档管理接口

### 4.1 创建文档

**接口**: `POST /api/documents`  
**描述**: 创建新的Markdown文档  
**认证**: 需要 (Bearer Token)

#### 请求参数

```json
{
  "title": "我的第一篇文章",
  "content": "# 标题\n\n这是文章内容..."
}
```

| 字段 | 类型 | 必填 | 说明 | 验证规则 |
|------|------|------|------|----------|
| title | String | 是 | 文档标题 | 不超过200字符 |
| content | String | 否 | 文档内容（Markdown格式） | - |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "创建成功",
  "data": {
    "id": 1,
    "userId": 1,
    "title": "我的第一篇文章",
    "content": "# 标题\n\n这是文章内容...",
    "wordCount": 150,
    "createdAt": "2025-12-25T10:00:00",
    "updatedAt": "2025-12-25T10:00:00"
  }
}
```

---

### 4.2 更新文档

**接口**: `PUT /api/documents/{id}`  
**描述**: 更新文档内容  
**认证**: 需要 (Bearer Token)

#### 路径参数

| 参数 | 类型 | 说明 |
|------|------|------|
| id | Long | 文档ID |

#### 请求参数

```json
{
  "title": "更新后的标题",
  "content": "更新后的内容..."
}
```

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "更新成功",
  "data": {
    "id": 1,
    "userId": 1,
    "title": "更新后的标题",
    "content": "更新后的内容...",
    "wordCount": 200,
    "createdAt": "2025-12-25T10:00:00",
    "updatedAt": "2025-12-25T11:30:00"
  }
}
```

---

### 4.3 获取文档列表

**接口**: `GET /api/documents`  
**描述**: 获取当前用户的所有文档  
**认证**: 需要 (Bearer Token)

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": [
    {
      "id": 2,
      "userId": 1,
      "title": "第二篇文章",
      "content": "...",
      "wordCount": 300,
      "createdAt": "2025-12-25T11:00:00",
      "updatedAt": "2025-12-25T11:30:00"
    },
    {
      "id": 1,
      "userId": 1,
      "title": "我的第一篇文章",
      "content": "...",
      "wordCount": 150,
      "createdAt": "2025-12-25T10:00:00",
      "updatedAt": "2025-12-25T10:00:00"
    }
  ]
}
```

---

### 4.4 获取文档详情

**接口**: `GET /api/documents/{id}`  
**描述**: 获取指定文档的详细信息  
**认证**: 需要 (Bearer Token)

#### 路径参数

| 参数 | 类型 | 说明 |
|------|------|------|
| id | Long | 文档ID |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    "id": 1,
    "userId": 1,
    "title": "我的第一篇文章",
    "content": "# 标题\n\n这是完整的文章内容...",
    "wordCount": 150,
    "createdAt": "2025-12-25T10:00:00",
    "updatedAt": "2025-12-25T10:00:00"
  }
}
```

**失败 (200)**
```json
{
  "success": false,
  "message": "文档不存在或无权限访问",
  "data": null
}
```

---

### 4.5 删除文档

**接口**: `DELETE /api/documents/{id}`  
**描述**: 删除指定文档  
**认证**: 需要 (Bearer Token)

#### 路径参数

| 参数 | 类型 | 说明 |
|------|------|------|
| id | Long | 文档ID |

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "删除成功",
  "data": null
}
```

---

## 5. 系统工具接口

### 5.1 健康检查

**接口**: `GET /api/health`  
**描述**: 检查系统运行状态  
**认证**: 不需要

#### 响应示例

**成功 (200)**
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    "status": "UP",
    "timestamp": "2025-12-25T17:30:00",
    "service": "Strove AI Writing Assistant",
    "version": "1.0.0-MVP"
  }
}
```

---

### 5.2 生成密码哈希（开发工具）

**接口**: `GET /api/tools/hash-password?password=123456`  
**描述**: 生成BCrypt密码哈希（仅用于开发测试，生产环境应删除）  
**认证**: 不需要  
**警告**: ⚠️ 生产环境必须删除此接口

#### 查询参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| password | String | 是 | 待加密的明文密码 |

#### 响应示例

**成功 (200)**
```
Password: 123456
BCrypt Hash: $2a$10$xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## 6. 数据模型

### 6.1 ApiResponse<T>

统一响应格式

```java
{
  "success": boolean,    // 操作是否成功
  "message": String,     // 响应消息
  "data": T             // 响应数据（泛型）
}
```

---

### 6.2 AuthResponse

认证响应数据

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "userId": 1,
  "username": "testuser",
  "email": "test@example.com"
}
```

---

### 6.3 Document

文档实体

```json
{
  "id": 1,
  "userId": 1,
  "title": "文档标题",
  "content": "文档内容（Markdown格式）",
  "wordCount": 150,
  "createdAt": "2025-12-25T10:00:00",
  "updatedAt": "2025-12-25T11:30:00"
}
```

---

### 6.4 Conversation

对话记录实体

```json
{
  "id": 123,
  "userId": 1,
  "documentId": 5,
  "message": "用户消息",
  "response": "AI回复",
  "createdAt": "2025-12-25T10:30:00"
}
```

---

### 6.5 ChatRequest

AI对话请求

```json
{
  "message": "用户消息内容",
  "apiKey": "sk-xxxxxxxxxxxxxxxx",
  "provider": "openai",
  "model": "gpt-3.5-turbo",
  "apiUrl": "https://api.openai.com/v1"
}
```

---

### 6.6 ChatResponse

AI对话响应

```json
{
  "reply": "AI回复内容",
  "conversationId": 123
}
```

---

### 6.7 InspirationRequest

灵感生成请求

```json
{
  "keyword": "关键词",
  "apiKey": "sk-xxxxxxxxxxxxxxxx",
  "provider": "openai",
  "model": "gpt-3.5-turbo",
  "apiUrl": "https://api.openai.com/v1"
}
```

---

## 7. 错误码说明

### 7.1 HTTP状态码

本系统所有接口均返回 **HTTP 200**，通过响应体中的 `success` 字段判断成功或失败。

### 7.2 常见错误消息

| success | message | 说明 |
|---------|---------|------|
| false | 用户名或密码错误 | 登录凭证无效 |
| false | 邮箱已被注册 | 注册时邮箱重复 |
| false | 用户名已被使用 | 注册时用户名重复 |
| false | API密钥无效 | AI服务商密钥验证失败 |
| false | AI请求失败：... | AI服务调用异常 |
| false | 文档不存在或无权限访问 | 文档查询权限问题 |
| false | 对话记录不存在或无权限删除 | 对话记录权限问题 |
| false | 消息内容不能为空 | 参数验证失败 |
| false | 文档标题不能为空 | 参数验证失败 |

### 7.3 JWT认证错误

如果JWT Token无效或过期，会返回 **HTTP 401 Unauthorized**：

```json
{
  "timestamp": "2025-12-25T17:30:00",
  "status": 401,
  "error": "Unauthorized",
  "message": "Invalid or expired token",
  "path": "/api/documents"
}
```

---

## 8. 最佳实践

### 8.1 API密钥管理

- **前端**：密钥应使用AES-256加密后存储在localStorage
- **后端**：不持久化存储用户密钥，仅在请求中传递
- **传输**：所有请求必须使用HTTPS

### 8.2 JWT Token管理

- Token有效期为24小时
- 前端应在localStorage中保存token
- 在每次请求时检查token是否存在
- Token过期后需重新登录

### 8.3 错误处理

```javascript
// 前端示例
try {
  const response = await api.post('/api/ai/chat', data);
  if (response.data.success) {
    // 处理成功
    console.log(response.data.data);
  } else {
    // 处理业务错误
    ElMessage.error(response.data.message);
  }
} catch (error) {
  // 处理网络错误
  if (error.response?.status === 401) {
    // Token过期，跳转登录
    router.push('/login');
  } else {
    ElMessage.error('网络请求失败');
  }
}
```

### 8.4 请求超时

- AI对话接口建议设置30秒超时
- 其他接口建议设置10秒超时

---

## 9. 开发调试

### 9.1 本地开发环境

```bash
# 后端启动
mvn spring-boot:run

# 访问地址
http://localhost:8123
```

### 9.2 接口测试工具

推荐使用以下工具测试接口：
- **Postman**
- **Insomnia**
- **cURL**
- **HTTPie**

### 9.3 测试账号

系统内置测试账号（首次启动自动创建）：

| 用户类型 | 邮箱 | 密码 |
|----------|------|------|
| 管理员 | admin@strove.ai | Admin123 |
| 普通用户 | user@strove.ai | User123 |

---

## 10. 更新日志

### v1.0.0 (2025-12-25)
- 初始版本发布
- 实现用户认证功能
- 实现AI对话、灵感生成、文本润色功能
- 实现Markdown文档管理功能
- 支持多家AI服务商

---

**文档维护**: 开发团队  
**最后更新**: 2025-12-25  
**联系方式**: dev@strove.ai
